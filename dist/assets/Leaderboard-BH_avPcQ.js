import{r as a,j as e,R as Q}from"./index-DOUn47hI.js";import{e as m,q as R,N as H,O as p,z as K,P as k,m as $,K as Y,Q as W,R as V}from"./index-Dwz6zuUR.js";import{a as Z,g as q,d as B,b as J}from"./firebaseConfig-DFE2fxb7.js";import{R as r,T as i,g as X,a as ee,b as se,s as te}from"./leaderboardService-mvmICTSr.js";import{m as A}from"./proxy-CqF-Z9lC.js";import{A as ae}from"./index-BjSeMe4p.js";function de(){const[u,P]=a.useState(null),[l,C]=a.useState(null),[n,N]=a.useState("department"),[d,L]=a.useState(r.AVERAGE_SCORE),[x,U]=a.useState(i.ALL_TIME),[I,v]=a.useState(null),[O,y]=a.useState(null),[c,_]=a.useState(null),[z,D]=a.useState(!0),[w,T]=a.useState(!1),[E,S]=a.useState(null);a.useEffect(()=>{(async()=>{try{const t=Z.currentUser;if(!t)return;const o=await q(B(J,"users",t.uid));if(o.exists()){const h=o.data();P({uid:t.uid,...h}),C(h.department)}}catch(t){console.error("Error fetching user data:",t)}})()},[]);const f=a.useCallback(async()=>{if(l){T(!0);try{console.log("📊 Loading leaderboards...");const[s,t,o]=await Promise.all([X(l,d,x),ee(d,x),u?se(u.uid,l,d,x):null]);v(s),y(t),_(o),S(new Date),console.log("✅ Leaderboards loaded successfully")}catch(s){console.error("❌ Error loading leaderboards:",s)}finally{T(!1),D(!1)}}},[l,d,x,u]);a.useEffect(()=>{f()},[f]),a.useEffect(()=>l?te(t=>{t.department&&v(t.department),t.global&&y(t.global),S(t.lastUpdated)},l):void 0,[l]);const F=s=>{switch(s){case r.AVERAGE_SCORE:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"};case r.TOTAL_SCORE:return{icon:e.jsx(W,{}),label:"Total Score",color:"text-blue-600"};case r.QUIZ_COUNT:return{icon:e.jsx(Y,{}),label:"Quiz Count",color:"text-green-600"};case r.STREAK:return{icon:e.jsx($,{}),label:"Current Streak",color:"text-orange-600"};case r.RECENT_PERFORMANCE:return{icon:e.jsx(k,{}),label:"Recent Performance",color:"text-purple-600"};default:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"}}},M=s=>{switch(s){case i.TODAY:return{label:"Today",icon:e.jsx(p,{})};case i.THIS_WEEK:return{label:"This Week",icon:e.jsx(p,{})};case i.THIS_MONTH:return{label:"This Month",icon:e.jsx(p,{})};default:return{label:"All Time",icon:e.jsx(p,{})}}},G=s=>s===1?{icon:e.jsx(m,{className:"text-yellow-500"}),color:"text-yellow-600 bg-yellow-50 border-yellow-200"}:s===2?{icon:e.jsx(V,{className:"text-gray-500"}),color:"text-gray-600 bg-gray-50 border-gray-200"}:s===3?{icon:e.jsx(m,{className:"text-orange-500"}),color:"text-orange-600 bg-orange-50 border-orange-200"}:s<=10?{icon:e.jsx(k,{className:"text-blue-500"}),color:"text-blue-600 bg-blue-50 border-blue-200"}:{icon:e.jsx(R,{className:"text-gray-400"}),color:"text-gray-600 bg-white border-gray-200"};if(z)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading leaderboards..."})]})});const b=n==="department"?I:O,g=F(d),j=M(x);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-2 sm:gap-3",children:[e.jsx(m,{className:"text-yellow-500 flex-shrink-0",size:24}),e.jsx("span",{className:"truncate",children:"Leaderboards"})]}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Compete with your peers and track your progress"})]})}),c&&e.jsxs(A.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-3 sm:p-4 w-full sm:max-w-sm sm:ml-auto",children:[e.jsx("h3",{className:"font-semibold text-xs sm:text-sm opacity-90",children:"Your Position"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg sm:text-2xl font-bold",children:["#",n==="department"?c.department.rank:c.global.rank]}),e.jsxs("div",{className:"text-xs opacity-75",children:["out of ",n==="department"?c.department.totalParticipants:c.global.totalParticipants]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm sm:text-lg font-semibold",children:[n==="department"?c.department.stats?.averagePercentage:c.global.stats?.averagePercentage,"%"]}),e.jsx("div",{className:"text-xs opacity-75",children:"avg score"})]})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>N("department"),className:`px-3 sm:px-4 py-2 rounded-md font-medium text-xs sm:text-sm transition-colors flex items-center gap-1 sm:gap-2 flex-1 sm:flex-initial justify-center ${n==="department"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(R,{size:14}),e.jsx("span",{className:"truncate",children:l}),e.jsx("span",{className:"hidden sm:inline",children:"Department"})]}),e.jsx("button",{onClick:()=>N("global"),className:`px-3 sm:px-4 py-2 rounded-md font-medium text-xs sm:text-sm transition-colors flex items-center gap-1 sm:gap-2 flex-1 sm:flex-initial justify-center ${n==="global"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🌍 Global"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"text-gray-400 flex-shrink-0",size:14}),e.jsxs("select",{value:d,onChange:s=>L(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1 sm:w-auto",children:[e.jsx("option",{value:r.AVERAGE_SCORE,children:"Average Score"}),e.jsx("option",{value:r.TOTAL_SCORE,children:"Total Score"}),e.jsx("option",{value:r.QUIZ_COUNT,children:"Quiz Count"}),e.jsx("option",{value:r.STREAK,children:"Current Streak"}),e.jsx("option",{value:r.RECENT_PERFORMANCE,children:"Recent Performance"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"text-gray-400 flex-shrink-0",size:14}),e.jsxs("select",{value:x,onChange:s=>U(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1 sm:w-auto",children:[e.jsx("option",{value:i.ALL_TIME,children:"All Time"}),e.jsx("option",{value:i.THIS_MONTH,children:"This Month"}),e.jsx("option",{value:i.THIS_WEEK,children:"This Week"}),e.jsx("option",{value:i.TODAY,children:"Today"})]})]}),e.jsxs("button",{onClick:f,disabled:w,className:"flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 text-xs sm:text-sm w-full sm:w-auto",children:[e.jsx(K,{className:w?"animate-spin":"",size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"Refresh"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g.color,children:g.icon}),e.jsxs("span",{children:["Ranking by: ",e.jsx("strong",{children:g.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.icon,e.jsxs("span",{children:["Period: ",e.jsx("strong",{children:j.label})]})]}),E&&e.jsx("div",{className:"flex items-center gap-2 text-xs",children:e.jsxs("span",{children:["Updated: ",E.toLocaleTimeString()]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[g.icon,n==="department"?`${l} Department`:"Global"," Leaderboard"]}),e.jsxs("p",{className:"opacity-90 text-sm mt-1",children:[b?.users?.length||0," participants • ",g.label," • ",j.label]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",children:b?.totalParticipants||0}),e.jsx("div",{className:"text-sm opacity-75",children:"Total Players"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:e.jsx(ae,{children:b?.users?.length>0?b.users.map((s,t)=>{const o=G(s.rank),h=u&&s.userId===u.uid;return e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:`p-4 hover:bg-gray-50 transition-colors ${h?"bg-blue-50 border-l-4 border-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 flex-shrink-0 ${o.color}`,children:e.jsxs("span",{className:"font-bold text-sm sm:text-lg",children:["#",s.rank]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:Q.cloneElement(o.icon,{size:16})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx("span",{className:"truncate",children:s.fullName}),h&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full flex-shrink-0",children:"You"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 truncate",children:[s.regNumber," ",n==="global"&&s.department&&`• ${s.department}`]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-6 text-xs sm:text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-bold text-sm sm:text-lg text-gray-900",children:[Math.round(s.averagePercentage),"%"]}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Avg"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-gray-900",children:s.totalQuizzes}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Quiz"})]}),s.recentStreak>0&&e.jsxs("div",{className:"text-center hidden sm:block",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-orange-600",children:s.recentStreak}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Streak"})]}),e.jsxs("div",{className:"text-center hidden sm:block",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-purple-600",children:s.totalPoints}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Points"})]})]})]})},s.userId)}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(m,{className:"mx-auto text-4xl mb-4 opacity-50"}),e.jsx("p",{children:"No rankings available for the selected period"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to take a quiz and claim the top spot!"})]})})})]})]})]})}export{de as default};
