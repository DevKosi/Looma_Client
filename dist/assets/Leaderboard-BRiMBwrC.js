import{r as a,j as e}from"./index-DatZN8-u.js";import{e as m,q as k,L as Q,M as u,A as H,N as A,m as $,I as K,O as Y,P as W}from"./index-EHIN2_jU.js";import{a as V,g as Z,d as q,b as B}from"./firebaseConfig-DFE2fxb7.js";import{R as r,T as i,g as J,a as X,b as ee,s as se}from"./leaderboardService-mvmICTSr.js";import{m as P}from"./proxy-MyAIwVy1.js";import{A as te}from"./index-DmtjZn8v.js";function oe(){const[h,R]=a.useState(null),[l,C]=a.useState(null),[n,N]=a.useState("department"),[d,L]=a.useState(r.AVERAGE_SCORE),[x,U]=a.useState(i.ALL_TIME),[I,v]=a.useState(null),[O,y]=a.useState(null),[c,_]=a.useState(null),[z,D]=a.useState(!0),[w,T]=a.useState(!1),[S,E]=a.useState(null);a.useEffect(()=>{(async()=>{try{const t=V.currentUser;if(!t)return;const o=await Z(q(B,"users",t.uid));if(o.exists()){const p=o.data();R({uid:t.uid,...p}),C(p.department)}}catch(t){console.error("Error fetching user data:",t)}})()},[]);const j=a.useCallback(async()=>{if(l){T(!0);try{console.log("ðŸ“Š Loading leaderboards...");const[s,t,o]=await Promise.all([J(l,d,x),X(d,x),h?ee(h.uid,l,d,x):null]);v(s),y(t),_(o),E(new Date),console.log("âœ… Leaderboards loaded successfully")}catch(s){console.error("âŒ Error loading leaderboards:",s)}finally{T(!1),D(!1)}}},[l,d,x,h]);a.useEffect(()=>{j()},[j]),a.useEffect(()=>l?se(t=>{t.department&&v(t.department),t.global&&y(t.global),E(t.lastUpdated)},l):void 0,[l]);const F=s=>{switch(s){case r.AVERAGE_SCORE:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"};case r.TOTAL_SCORE:return{icon:e.jsx(Y,{}),label:"Total Score",color:"text-blue-600"};case r.QUIZ_COUNT:return{icon:e.jsx(K,{}),label:"Quiz Count",color:"text-green-600"};case r.STREAK:return{icon:e.jsx($,{}),label:"Current Streak",color:"text-orange-600"};case r.RECENT_PERFORMANCE:return{icon:e.jsx(A,{}),label:"Recent Performance",color:"text-purple-600"};default:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"}}},M=s=>{switch(s){case i.TODAY:return{label:"Today",icon:e.jsx(u,{})};case i.THIS_WEEK:return{label:"This Week",icon:e.jsx(u,{})};case i.THIS_MONTH:return{label:"This Month",icon:e.jsx(u,{})};default:return{label:"All Time",icon:e.jsx(u,{})}}},G=s=>s===1?{icon:e.jsx(m,{className:"text-yellow-500"}),color:"text-yellow-600 bg-yellow-50 border-yellow-200"}:s===2?{icon:e.jsx(W,{className:"text-gray-500"}),color:"text-gray-600 bg-gray-50 border-gray-200"}:s===3?{icon:e.jsx(m,{className:"text-orange-500"}),color:"text-orange-600 bg-orange-50 border-orange-200"}:s<=10?{icon:e.jsx(A,{className:"text-blue-500"}),color:"text-blue-600 bg-blue-50 border-blue-200"}:{icon:e.jsx(k,{className:"text-gray-400"}),color:"text-gray-600 bg-white border-gray-200"};if(z)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Loading leaderboards..."})]})});const b=n==="department"?I:O,g=F(d),f=M(x);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2 sm:gap-3",children:[e.jsx(m,{className:"text-yellow-500",size:24}),e.jsx("span",{children:"Leaderboards"})]}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Compete with your peers and track your progress"})]}),c&&e.jsxs(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 w-full lg:min-w-64 lg:w-auto",children:[e.jsx("h3",{className:"font-semibold text-sm opacity-90",children:"Your Position"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold",children:["#",n==="department"?c.department.rank:c.global.rank]}),e.jsxs("div",{className:"text-xs opacity-75",children:["out of ",n==="department"?c.department.totalParticipants:c.global.totalParticipants]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-base sm:text-lg font-semibold",children:[n==="department"?c.department.stats?.averagePercentage:c.global.stats?.averagePercentage,"%"]}),e.jsx("div",{className:"text-xs opacity-75",children:"avg score"})]})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>N("department"),className:`px-3 sm:px-4 py-2 rounded-md font-medium text-xs sm:text-sm transition-colors flex-1 sm:flex-none ${n==="department"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(k,{className:"inline mr-1 sm:mr-2",size:14}),e.jsxs("span",{className:"hidden sm:inline",children:[l," Department"]}),e.jsx("span",{className:"sm:hidden",children:"Department"})]}),e.jsxs("button",{onClick:()=>N("global"),className:`px-3 sm:px-4 py-2 rounded-md font-medium text-xs sm:text-sm transition-colors flex-1 sm:flex-none ${n==="global"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx("span",{className:"mr-1 sm:mr-2",children:"ðŸŒ"}),e.jsx("span",{children:"Global"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Q,{className:"text-gray-400 flex-shrink-0",size:16}),e.jsxs("select",{value:d,onChange:s=>L(s.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:r.AVERAGE_SCORE,children:"Average Score"}),e.jsx("option",{value:r.TOTAL_SCORE,children:"Total Score"}),e.jsx("option",{value:r.QUIZ_COUNT,children:"Quiz Count"}),e.jsx("option",{value:r.STREAK,children:"Current Streak"}),e.jsx("option",{value:r.RECENT_PERFORMANCE,children:"Recent Performance"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(u,{className:"text-gray-400 flex-shrink-0",size:16}),e.jsxs("select",{value:x,onChange:s=>U(s.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:i.ALL_TIME,children:"All Time"}),e.jsx("option",{value:i.THIS_MONTH,children:"This Month"}),e.jsx("option",{value:i.THIS_WEEK,children:"This Week"}),e.jsx("option",{value:i.TODAY,children:"Today"})]})]}),e.jsxs("button",{onClick:j,disabled:w,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(H,{className:w?"animate-spin":"",size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600 pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g.color,children:g.icon}),e.jsxs("span",{children:["Ranking by: ",e.jsx("strong",{children:g.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.icon,e.jsxs("span",{children:["Period: ",e.jsx("strong",{children:f.label})]})]}),S&&e.jsx("div",{className:"flex items-center gap-2 text-xs",children:e.jsxs("span",{children:["Updated: ",S.toLocaleTimeString()]})})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold flex items-center gap-2",children:[g.icon,e.jsxs("span",{children:[n==="department"?`${l} Department`:"Global"," Leaderboard"]})]}),e.jsxs("p",{className:"opacity-90 text-sm mt-1",children:[b?.users?.length||0," participants â€¢ ",g.label," â€¢ ",f.label]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:b?.totalParticipants||0}),e.jsx("div",{className:"text-sm opacity-75",children:"Total Players"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:e.jsx(te,{children:b?.users?.length>0?b.users.map((s,t)=>{const o=G(s.rank),p=h&&s.userId===h.uid;return e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:`p-3 sm:p-4 hover:bg-gray-50 transition-colors ${p?"bg-blue-50 border-l-4 border-blue-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 flex-shrink-0 ${o.color}`,children:e.jsxs("span",{className:"font-bold text-sm sm:text-lg",children:["#",s.rank]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:o.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx("span",{className:"truncate",children:s.fullName}),p&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full flex-shrink-0",children:"You"})]}),e.jsxs("div",{className:"text-xs sm:text-sm text-gray-500 truncate",children:[s.regNumber," ",n==="global"&&s.department&&`â€¢ ${s.department}`]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-6 text-xs sm:text-sm flex-shrink-0",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-bold text-sm sm:text-lg text-gray-900",children:[Math.round(s.averagePercentage),"%"]}),e.jsx("div",{className:"text-gray-500",children:"Avg"})]}),e.jsxs("div",{className:"text-center hidden sm:block",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-gray-900",children:s.totalQuizzes}),e.jsx("div",{className:"text-gray-500",children:"Quizzes"})]}),s.recentStreak>0&&e.jsxs("div",{className:"text-center hidden md:block",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-orange-600",children:s.recentStreak}),e.jsx("div",{className:"text-gray-500",children:"Streak"})]}),e.jsxs("div",{className:"text-center hidden lg:block",children:[e.jsx("div",{className:"font-bold text-sm sm:text-lg text-purple-600",children:s.totalPoints}),e.jsx("div",{className:"text-gray-500",children:"Points"})]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-around text-xs text-gray-600 sm:hidden",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:s.totalQuizzes}),e.jsx("div",{children:"Quizzes"})]}),s.recentStreak>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-orange-600",children:s.recentStreak}),e.jsx("div",{children:"Streak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-purple-600",children:s.totalPoints}),e.jsx("div",{children:"Points"})]})]})]},s.userId)}):e.jsxs("div",{className:"p-6 sm:p-8 text-center text-gray-500",children:[e.jsx(m,{className:"mx-auto text-4xl mb-4 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-base",children:"No rankings available for the selected period"}),e.jsx("p",{className:"text-xs sm:text-sm mt-1",children:"Be the first to take a quiz and claim the top spot!"})]})})})]})]})]})}export{oe as default};
