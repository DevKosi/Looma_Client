import{r as a,j as e}from"./index-CZAGcK71.js";import{e as m,p as R,M as Q,N as b,y as H,O as A,P as K,J as Y,Q as $,R as W}from"./index-CvBFJOG1.js";import{a as V,g as Z,d as B,b as q}from"./firebaseConfig-DFE2fxb7.js";import{R as r,T as i,a as J,b as X,g as ee,s as se}from"./leaderboardService-D8JqEqBy.js";import{m as P}from"./proxy-D1C_7dPn.js";import{A as te}from"./index-KPeVrOLb.js";function ce(){const[u,C]=a.useState(null),[l,L]=a.useState(null),[n,v]=a.useState("department"),[d,k]=a.useState(r.AVERAGE_SCORE),[x,U]=a.useState(i.ALL_TIME),[I,N]=a.useState(null),[O,y]=a.useState(null),[o,_]=a.useState(null),[D,F]=a.useState(!0),[T,w]=a.useState(!1),[S,E]=a.useState(null);a.useEffect(()=>{(async()=>{try{const t=V.currentUser;if(!t)return;const c=await Z(B(q,"users",t.uid));if(c.exists()){const h=c.data();C({uid:t.uid,...h}),L(h.department)}}catch(t){console.error("Error fetching user data:",t)}})()},[]);const j=a.useCallback(async()=>{if(l){w(!0);try{console.log("📊 Loading leaderboards...");const[s,t,c]=await Promise.all([J(l,d,x),X(d,x),u?ee(u.uid,l,d,x):null]);N(s),y(t),_(c),E(new Date),console.log("✅ Leaderboards loaded successfully")}catch(s){console.error("❌ Error loading leaderboards:",s)}finally{w(!1),F(!1)}}},[l,d,x,u]);a.useEffect(()=>{j()},[j]),a.useEffect(()=>l?se(t=>{t.department&&N(t.department),t.global&&y(t.global),E(t.lastUpdated)},l):void 0,[l]);const M=s=>{switch(s){case r.AVERAGE_SCORE:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"};case r.TOTAL_SCORE:return{icon:e.jsx($,{}),label:"Total Score",color:"text-blue-600"};case r.QUIZ_COUNT:return{icon:e.jsx(Y,{}),label:"Quiz Count",color:"text-green-600"};case r.STREAK:return{icon:e.jsx(K,{}),label:"Current Streak",color:"text-orange-600"};case r.RECENT_PERFORMANCE:return{icon:e.jsx(A,{}),label:"Recent Performance",color:"text-purple-600"};default:return{icon:e.jsx(m,{}),label:"Average Score",color:"text-yellow-600"}}},G=s=>{switch(s){case i.TODAY:return{label:"Today",icon:e.jsx(b,{})};case i.THIS_WEEK:return{label:"This Week",icon:e.jsx(b,{})};case i.THIS_MONTH:return{label:"This Month",icon:e.jsx(b,{})};default:return{label:"All Time",icon:e.jsx(b,{})}}},z=s=>s===1?{icon:e.jsx(m,{className:"text-yellow-500"}),color:"text-yellow-600 bg-yellow-50 border-yellow-200"}:s===2?{icon:e.jsx(W,{className:"text-gray-500"}),color:"text-gray-600 bg-gray-50 border-gray-200"}:s===3?{icon:e.jsx(m,{className:"text-orange-500"}),color:"text-orange-600 bg-orange-50 border-orange-200"}:s<=10?{icon:e.jsx(A,{className:"text-blue-500"}),color:"text-blue-600 bg-blue-50 border-blue-200"}:{icon:e.jsx(R,{className:"text-gray-400"}),color:"text-gray-600 bg-white border-gray-200"};if(D)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading leaderboards..."})]})});const p=n==="department"?I:O,g=M(d),f=G(x);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(m,{className:"text-yellow-500"}),"Leaderboards"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Compete with your peers and track your progress"})]}),o&&e.jsxs(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 min-w-64",children:[e.jsx("h3",{className:"font-semibold text-sm opacity-90",children:"Your Position"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["#",n==="department"?o.department.rank:o.global.rank]}),e.jsxs("div",{className:"text-xs opacity-75",children:["out of ",n==="department"?o.department.totalParticipants:o.global.totalParticipants]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[n==="department"?o.department.stats?.averagePercentage:o.global.stats?.averagePercentage,"%"]}),e.jsx("div",{className:"text-xs opacity-75",children:"avg score"})]})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>v("department"),className:`px-4 py-2 rounded-md font-medium text-sm transition-colors ${n==="department"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(R,{className:"inline mr-2"}),l," Department"]}),e.jsx("button",{onClick:()=>v("global"),className:`px-4 py-2 rounded-md font-medium text-sm transition-colors ${n==="global"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"🌍 Global"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-gray-400"}),e.jsxs("select",{value:d,onChange:s=>k(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:r.AVERAGE_SCORE,children:"Average Score"}),e.jsx("option",{value:r.TOTAL_SCORE,children:"Total Score"}),e.jsx("option",{value:r.QUIZ_COUNT,children:"Quiz Count"}),e.jsx("option",{value:r.STREAK,children:"Current Streak"}),e.jsx("option",{value:r.RECENT_PERFORMANCE,children:"Recent Performance"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"text-gray-400"}),e.jsxs("select",{value:x,onChange:s=>U(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:i.ALL_TIME,children:"All Time"}),e.jsx("option",{value:i.THIS_MONTH,children:"This Month"}),e.jsx("option",{value:i.THIS_WEEK,children:"This Week"}),e.jsx("option",{value:i.TODAY,children:"Today"})]})]}),e.jsxs("button",{onClick:j,disabled:T,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 text-sm",children:[e.jsx(H,{className:T?"animate-spin":""}),"Refresh"]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:g.color,children:g.icon}),e.jsxs("span",{children:["Ranking by: ",e.jsx("strong",{children:g.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f.icon,e.jsxs("span",{children:["Period: ",e.jsx("strong",{children:f.label})]})]}),S&&e.jsx("div",{className:"flex items-center gap-2 text-xs",children:e.jsxs("span",{children:["Updated: ",S.toLocaleTimeString()]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[g.icon,n==="department"?`${l} Department`:"Global"," Leaderboard"]}),e.jsxs("p",{className:"opacity-90 text-sm mt-1",children:[p?.users?.length||0," participants • ",g.label," • ",f.label]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",children:p?.totalParticipants||0}),e.jsx("div",{className:"text-sm opacity-75",children:"Total Players"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:e.jsx(te,{children:p?.users?.length>0?p.users.map((s,t)=>{const c=z(s.rank),h=u&&s.userId===u.uid;return e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:`p-4 hover:bg-gray-50 transition-colors ${h?"bg-blue-50 border-l-4 border-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-full border-2 ${c.color}`,children:e.jsxs("span",{className:"font-bold text-lg",children:["#",s.rank]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[c.icon,e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[s.fullName,h&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:"You"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.regNumber," • ",n==="global"?s.department:""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-bold text-lg text-gray-900",children:[Math.round(s.averagePercentage),"%"]}),e.jsx("div",{className:"text-gray-500",children:"Avg Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-lg text-gray-900",children:s.totalQuizzes}),e.jsx("div",{className:"text-gray-500",children:"Quizzes"})]}),s.recentStreak>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-lg text-orange-600",children:s.recentStreak}),e.jsx("div",{className:"text-gray-500",children:"Streak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-lg text-purple-600",children:s.totalPoints}),e.jsx("div",{className:"text-gray-500",children:"Points"})]})]})]})},s.userId)}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(m,{className:"mx-auto text-4xl mb-4 opacity-50"}),e.jsx("p",{children:"No rankings available for the selected period"}),e.jsx("p",{className:"text-sm mt-1",children:"Be the first to take a quiz and claim the top spot!"})]})})})]})]})]})}export{ce as default};
