import{R as me,j as e,r as y,u as Fe}from"./index-CEPvpZEd.js";import{a as $,d as I,b as v,g as qe,q as M,h as Q,w as J,i as A,r as re,j as V,k as Ee,l as ie}from"./firebaseConfig-DFE2fxb7.js";import{g as De,p as Ue,h as W,l as $e,q as ne,r as ee,s as Oe,f as oe,t as Pe,u as K,v as pe,w as te,x as Le,n as _e}from"./index-DIUg2I6z.js";import{d as Be}from"./debugHelpers-DY2nFLsE.js";import{A as Ie}from"./index-BFIU46PT.js";import{m as T}from"./proxy-BFX65BA8.js";const Me=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),xe=i=>Array.isArray(i)&&i.every(a=>typeof a=="object"&&!(a instanceof Array)),Ve=i=>Array.isArray(i)&&i.every(a=>Array.isArray(a)),We=i=>Array.from(i.map(a=>Object.keys(a)).reduce((a,o)=>new Set([...a,...o]),[])),He=(i,a)=>{a=a||We(i);let o=a,n=a;xe(a)&&(o=a.map(d=>d.label),n=a.map(d=>d.key));const r=i.map(d=>n.map(u=>Ze(u,d)));return[o,...r]},Ze=(i,a)=>{const o=i.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(n,r,d,u){const g=n[r];if(g==null)u.splice(1);else return g},a);return o===void 0?i in a?a[i]:"":o},Je=i=>typeof i>"u"||i===null?"":i,he=(i,a=",",o='"')=>i.filter(n=>n).map(n=>n.map(r=>Je(r)).map(r=>`${o}${r}${o}`).join(a)).join(`
`),Ke=(i,a,o,n)=>he(a?[a,...i]:i,o,n),Xe=(i,a,o,n)=>he(He(i,a),o,n),Ye=(i,a,o,n)=>a?`${a.join(o)}
${i}`:i.replace(/"/g,'""'),ge=(i,a,o,n)=>{if(xe(i))return Xe(i,a,o,n);if(Ve(i))return Ke(i,a,o,n);if(typeof i=="string")return Ye(i,a,o);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},fe=(i,a,o,n,r)=>{const d=ge(i,o,n,r),u=Me()?"application/csv":"text/csv",g=new Blob([a?"\uFEFF":"",d],{type:u}),x=`data:${u};charset=utf-8,${a?"\uFEFF":""}${d}`,m=window.URL||window.webkitURL;return typeof m.createObjectURL>"u"?x:m.createObjectURL(g)};var X={exports:{}},Y,le;function Ge(){if(le)return Y;le=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Y=i,Y}var G,ce;function et(){if(ce)return G;ce=1;var i=Ge();function a(){}function o(){}return o.resetWarningCache=a,G=function(){function n(u,g,x,m,k,c){if(c!==i){var j=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw j.name="Invariant Violation",j}}n.isRequired=n;function r(){return n}var d={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:o,resetWarningCache:a};return d.PropTypes=d,d},G}var de;function tt(){return de||(de=1,X.exports=et()()),X.exports}var z=tt();const ye={data:z.oneOfType([z.string,z.array,z.func]).isRequired,headers:z.array,target:z.string,separator:z.string,filename:z.string,uFEFF:z.bool,onClick:z.func,asyncOnClick:z.bool,enclosingCharacter:z.string},be={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},st={target:"_blank"};class pt extends me.Component{static defaultProps=Object.assign(be,st);static propTypes=ye;constructor(a){super(a),this.state={}}buildURI(){return fe(...arguments)}componentDidMount(){const{data:a,headers:o,separator:n,enclosingCharacter:r,uFEFF:d,target:u,specs:g,replace:x}=this.props;this.state.page=window.open(this.buildURI(a,d,o,n,r),u,g,x)}getWindow(){return this.state.page}render(){return null}}let at=class extends me.Component{static defaultProps=be;static propTypes=ye;constructor(a){super(a),this.buildURI=this.buildURI.bind(this)}buildURI(){return fe(...arguments)}handleLegacy(a,o=!1){if(window.navigator.msSaveOrOpenBlob){a.preventDefault();const{data:n,headers:r,separator:d,filename:u,enclosingCharacter:g,uFEFF:x}=this.props,m=o&&typeof n=="function"?n():n;let k=new Blob([x?"\uFEFF":"",ge(m,r,d,g)]);return window.navigator.msSaveBlob(k,u),!1}}handleAsyncClick(a){const o=n=>{if(n===!1){a.preventDefault();return}this.handleLegacy(a,!0)};this.props.onClick(a,o)}handleSyncClick(a){if(this.props.onClick(a)===!1){a.preventDefault();return}this.handleLegacy(a)}handleClick(){return a=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(a):this.handleSyncClick(a);this.handleLegacy(a)}}render(){const{data:a,headers:o,separator:n,filename:r,uFEFF:d,children:u,onClick:g,asyncOnClick:x,enclosingCharacter:m,...k}=this.props,j=typeof window>"u"?"":this.buildURI(a,d,o,n,m);return e.jsx("a",{download:r,...k,ref:N=>this.link=N,target:"_self",href:j,onClick:this.handleClick(),children:u})}};const rt=at,ht=()=>{const[i,a]=y.useState(null),[o,n]=y.useState([]),[r,d]=y.useState("create"),[u,g]=y.useState({title:"",description:"",timeLimit:30,questionsToRender:"",status:"draft",questions:[]}),[x,m]=y.useState({admin:!0,quizzes:!1,action:!1,results:!1}),[k,c]=y.useState(null),[j,N]=y.useState(""),[h,F]=y.useState(null),[O,je]=y.useState({totalQuizzes:0,activeQuizzes:0,draftQuizzes:0,totalParticipants:0}),[P,se]=y.useState([]),[it,nt]=y.useState(!1),[S,L]=y.useState(null),q=Fe(),ae=y.useCallback(async()=>{try{const t=$.currentUser;if(!t)return q("/login");const s=I(v,"users",t.uid),l=await qe(s);l.exists()&&l.data().role==="admin"?(a({...l.data(),uid:t.uid}),_(l.data().department),E(l.data().department)):q("/login")}catch{w("Failed to load admin data","error")}finally{m(t=>({...t,admin:!1}))}},[q]),_=y.useCallback(async t=>{m(s=>({...s,quizzes:!0}));try{const s=M(Q(v,"quizzes"),J("department","==",t),J("createdBy","==",$.currentUser.uid)),p=(await A(s)).docs.map(f=>({id:f.id,...f.data()}));n(p)}catch{w("Failed to fetch quizzes","error")}finally{m(s=>({...s,quizzes:!1}))}},[]),E=y.useCallback(async t=>{try{const s=M(Q(v,"quizzes"),J("department","==",t)),l=await A(s),p=l.size,f=l.docs.filter(C=>C.data().status==="approved").length,R=l.docs.filter(C=>C.data().status==="draft").length;let b=0;for(const C of l.docs){const U=Q(v,"quizzes",C.id,"submissions"),Te=await A(U);b+=Te.size}je({totalQuizzes:p,activeQuizzes:f,draftQuizzes:R,totalParticipants:b})}catch(s){console.error("Error fetching stats:",s)}},[]),Z=y.useCallback(async t=>{m(s=>({...s,results:!0}));try{const s=Q(v,"quizzes",t,"submissions"),l=await A(s);console.log(`ðŸ“Š FOUND ${l.size} SUBMISSIONS FOR QUIZ ${t}`);const p=l.docs.map((f,R)=>{const b=f.data();console.log(`Raw submission data ${R+1}:`,b);const C={id:f.id,...b,timestamp:b.submittedAt?.toDate?b.submittedAt.toDate().toLocaleString():"Unknown",percentage:typeof b.percentage=="number"?b.percentage:0,timeSpent:typeof b.timeSpent=="number"?b.timeSpent:0,email:b.email||"No email",regNumber:b.regNumber||"Anonymous",fullName:b.fullName||"Unknown",department:b.department||"Unknown"};return C.regNumber==="Anonymous"&&console.warn(`âš ï¸ Anonymous regNumber in submission ${R+1}`),C.percentage===0&&b.score>0&&console.warn(`âš ï¸ Zero percentage despite score > 0 in submission ${R+1}`),C.email==="No email"&&console.warn(`âš ï¸ Missing email in submission ${R+1}`),C});console.log("Processed results data:",p),Be(t),se(p)}catch(s){console.error("Error fetching results:",s),w("Failed to fetch results","error")}finally{m(s=>({...s,results:!1}))}},[]);y.useEffect(()=>{ae()},[ae]),y.useEffect(()=>{h&&r==="manage"&&Z(h)},[h,r,Z]);const w=(t,s="success")=>{c({message:t,type:s}),setTimeout(()=>c(null),5e3)},D=t=>{const{name:s,value:l}=t.target;g(p=>({...p,[s]:l}))},Ne=async t=>{t.preventDefault(),m(s=>({...s,action:!0}));try{const s={...u,department:i.department,createdBy:i.uid,createdAt:V(),updatedAt:V()};if(s.questions.length===0)throw new Error("Please add at least one question");const l=await Ee(Q(v,"quizzes"),s);w("Quiz created successfully!"),g({title:"",description:"",timeLimit:30,status:"draft",questions:[]}),F(l.id),_(i.department),E(i.department)}catch(s){w(s.message,"error")}finally{m(s=>({...s,action:!1}))}},B=async(t,s)=>{m(l=>({...l,action:!0}));try{await re(v,async l=>{const p=I(v,"quizzes",t),f=await l.get(p);if(!f.exists())throw new Error("Quiz does not exist!");if(f.data().createdBy!==$.currentUser.uid)throw new Error("Unauthorized update attempt");l.update(p,{...s,updatedAt:V()})}),w("Quiz updated successfully!"),_(i.department),E(i.department),S?.id===t&&g(l=>({...l,...s}))}catch(l){w(l.message,"error")}finally{m(l=>({...l,action:!1}))}},ve=async t=>{if(window.confirm("Are you sure you want to delete this quiz and all its data?")){m(s=>({...s,action:!0}));try{await re(v,async s=>{const l=I(v,"quizzes",t),p=await s.get(l);if(!p.exists())throw new Error("Quiz does not exist!");if(p.data().createdBy!==$.currentUser.uid)throw new Error("Unauthorized deletion attempt");s.delete(l);const f=M(Q(v,"quizzes",t,"codes"));(await A(f)).forEach(U=>{s.delete(U.ref)});const b=M(Q(v,"quizzes",t,"submissions"));(await A(b)).forEach(U=>{s.delete(U.ref)})}),w("Quiz and all associated data deleted successfully!"),_(i.department),E(i.department),F(null),L(null)}catch(s){w(`Deletion failed: ${s.message}`,"error")}finally{m(s=>({...s,action:!1}))}}},we=async()=>{if(!(!h||!j.trim())){m(t=>({...t,action:!0}));try{const t=j.split(/\s+/).filter(l=>l.trim().length>0),s=ie(v);t.forEach(l=>{const p=I(Q(v,"quizzes",h,"codes"),l);s.set(p,{code:l,used:!1,usedBy:null,createdAt:V()})}),await s.commit(),w(`${t.length} codes uploaded successfully!`),N("")}catch{w("Failed to upload codes","error")}finally{m(t=>({...t,action:!1}))}}},ze=async t=>{if(window.confirm("Permanently delete all results for this quiz?")){m(s=>({...s,action:!0}));try{const s=ie(v),l=Q(v,"quizzes",t,"submissions");(await A(l)).forEach(f=>{s.delete(f.ref)}),await s.commit(),se([]),w("Results cleared successfully"),E(i.department)}catch{w("Failed to clear results","error")}finally{m(s=>({...s,action:!1}))}}},Ce=t=>{if(!t.text.trim())return;const s=[...u.questions,{...t,id:Date.now().toString()}];g({...u,questions:s})},ke=(t,s)=>{g({...u,questions:u.questions.map(l=>l.id===t?{...l,...s}:l)})},Se=t=>{g({...u,questions:u.questions.filter(s=>s.id!==t)})},Qe=t=>{L(t),g({title:t.title,description:t.description,timeLimit:t.timeLimit,questionsToRender:t.questionsToRender||"",status:t.status,questions:t.questions||[]}),d("create")},Re=()=>{L(null),g({title:"",description:"",timeLimit:30,questionsToRender:"",status:"draft",questions:[]})},Ae=async()=>{await $.signOut(),q("/login")};return x.admin?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Admin Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[i?.department," Department"]})]}),e.jsxs("button",{onClick:Ae,className:"flex items-center gap-2 text-red-600 hover:text-red-700",children:[e.jsx(De,{})," Logout"]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(H,{icon:e.jsx(Ue,{className:"text-blue-500",size:20}),title:"Total Quizzes",value:O.totalQuizzes,loading:x.quizzes}),e.jsx(H,{icon:e.jsx(W,{className:"text-green-500",size:20}),title:"Active Quizzes",value:O.activeQuizzes,loading:x.quizzes}),e.jsx(H,{icon:e.jsx($e,{className:"text-yellow-500",size:20}),title:"Draft Quizzes",value:O.draftQuizzes,loading:x.quizzes}),e.jsx(H,{icon:e.jsx(ne,{className:"text-purple-500",size:20}),title:"Total Participants",value:O.totalParticipants,loading:x.quizzes})]}),e.jsxs("div",{className:"flex border-b border-gray-200 mb-6",children:[e.jsxs("button",{onClick:()=>{d("create"),L(null)},className:`px-4 py-2 font-medium text-sm flex items-center gap-2 ${r==="create"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ee,{})," ",S?"Edit Quiz":"Create Quiz"]}),e.jsxs("button",{onClick:()=>d("manage"),className:`px-4 py-2 font-medium text-sm flex items-center gap-2 ${r==="manage"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Oe,{})," Manage Quizzes"]}),e.jsxs("button",{onClick:()=>d("results"),className:`px-4 py-2 font-medium text-sm flex items-center gap-2 ${r==="results"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(W,{})," Quiz Results"]}),e.jsxs("button",{onClick:()=>d("questions"),className:`px-4 py-2 font-medium text-sm flex items-center gap-2 ${r==="questions"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(oe,{})," Manage Questions"]}),e.jsxs("button",{onClick:()=>q("/leaderboard"),className:"px-4 py-2 font-medium text-sm flex items-center gap-2 text-gray-500 hover:text-gray-700",children:[e.jsx(ne,{})," Leaderboard"]})]}),e.jsx(Ie,{children:k&&e.jsx(T.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`p-3 rounded-md mb-6 ${k.type==="error"?"bg-red-50 text-red-700":"bg-green-50 text-green-700"}`,children:k.message})}),r==="create"&&e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:S?"Edit Quiz":"Create New Quiz"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),S?B(S.id,u):Ne(t)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:u.title,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:u.description,onChange:D,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Limit (minutes)"}),e.jsx("input",{type:"number",name:"timeLimit",min:"1",value:u.timeLimit,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Questions to Render"}),e.jsx("input",{type:"number",name:"questionsToRender",min:"1",value:u.questionsToRender||u.questions.length,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"All questions"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Number of questions to show per quiz attempt"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:u.status,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending",children:"Submit for Approval"}),S?.status==="approved"&&e.jsx("option",{value:"approved",children:"Approved"})]})]})]}),e.jsx(ue,{questions:u.questions,addQuestion:Ce,updateQuestion:ke,removeQuestion:Se}),e.jsxs("div",{className:"pt-2 flex justify-between",children:[S&&e.jsx("button",{type:"button",onClick:Re,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel Editing"}),e.jsx("button",{type:"submit",disabled:x.action||u.questions.length===0,className:`px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md flex items-center justify-center gap-2 disabled:opacity-50 ${S?"ml-auto":"w-full"}`,children:x.action?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{})," ",S?"Update Quiz":"Create Quiz"]})})]})]})]}),r==="manage"&&e.jsxs("div",{className:"space-y-6",children:[x.quizzes?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):o.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No quizzes found"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-gray-50 p-4 border-b border-gray-200 font-medium text-sm text-gray-500",children:[e.jsx("div",{className:"col-span-4",children:"Title"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Questions Pool"}),e.jsx("div",{className:"col-span-1",children:"Renders"}),e.jsx("div",{className:"col-span-3",children:"Actions"})]}),o.map(t=>e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-12 p-4 border-b border-gray-200 items-center hover:bg-gray-50",children:[e.jsxs("div",{className:"col-span-4 font-medium text-gray-800",children:[t.title,e.jsx("p",{className:"text-sm text-gray-500 truncate",children:t.description})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.status})}),e.jsxs("div",{className:"col-span-2 text-gray-600",children:[t.questions?.length||0," questions"]}),e.jsx("div",{className:"col-span-1 text-gray-600 text-sm",children:t.questionsToRender||"All"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{F(t.id),N("")},className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"Upload Codes",children:e.jsx(K,{size:16})}),e.jsx("button",{onClick:()=>Qe(t),className:"p-2 text-yellow-600 hover:bg-yellow-50 rounded",title:"Edit Quiz",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>ve(t.id),disabled:x.action,className:"p-2 text-red-600 hover:bg-red-50 rounded disabled:opacity-50",title:"Delete Quiz",children:e.jsx(te,{size:16})})]})]},t.id))]}),h&&e.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(K,{})," Upload Access Codes"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Paste codes below (one per line or separated by spaces)"}),e.jsx("textarea",{value:j,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",rows:"6",placeholder:"CODE1 CODE2 CODE3..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{F(null),N("")},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:we,disabled:!j.trim()||x.action,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md flex items-center gap-2 disabled:opacity-50",children:x.action?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{})," Upload Codes"]})})]})]})]}),r==="results"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Select Quiz to View Results"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(t=>e.jsxs(T.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{F(t.id),Z(t.id)},className:`p-4 border rounded-lg cursor-pointer transition-all ${h===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("h3",{className:"font-medium text-gray-800",children:t.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t.description}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.status}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.questions?.length||0," questions"]})]})]},t.id))})]}),h&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(W,{})," Results for: ",o.find(t=>t.id===h)?.title]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Total Submissions: ",P.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(rt,{data:P.map(t=>({"Registration Number":t.regNumber,"Full Name":t.fullName,Department:t.department,Email:t.email,Score:t.score,Total:t.total,Percentage:t.percentage+"%","Time Spent (mins)":Math.round((t.timeSpent||0)/60),"Submitted At":t.timestamp,"Quiz Title":t.quizTitle})),filename:`quiz-results-${o.find(t=>t.id===h)?.title}-${new Date().toISOString().split("T")[0]}.csv`,className:"flex items-center gap-2 px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition-colors",children:[e.jsx(Le,{})," Export CSV"]}),e.jsxs("button",{onClick:()=>ze(h),className:"flex items-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg transition-colors",children:[e.jsx(te,{})," Clear All Results"]})]})]}),x.results?e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading results..."})]})}):P.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"mx-auto text-4xl text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No submissions found for this quiz"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Results will appear here when students submit the quiz"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Registration Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Percentage"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time Spent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submitted At"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map((t,s)=>e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.fullName||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email||"No email"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.regNumber==="Anonymous"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:t.regNumber||"Anonymous"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.department||"Unknown"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("span",{className:"text-gray-900",children:t.score}),e.jsxs("span",{className:"text-gray-500",children:[" / ",t.total]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:`h-2 rounded-full mr-2 ${(t.percentage||0)>=70?"bg-green-200":(t.percentage||0)>=50?"bg-yellow-200":"bg-red-200"}`,children:e.jsx("div",{className:`h-2 rounded-full ${(t.percentage||0)>=70?"bg-green-500":(t.percentage||0)>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(t.percentage||0,100)}%`}})})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 ml-2",children:[t.percentage||0,"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.timeSpent?`${Math.round(t.timeSpent/60)} mins`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.timestamp||"Unknown"})]},t.id))})]})})]})]}),r==="questions"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:h?`Editing: ${o.find(t=>t.id===h)?.title}`:"Select a Quiz to Edit Questions"}),h?e.jsx(ue,{questions:o.find(t=>t.id===h)?.questions||[],addQuestion:t=>{const l=[...o.find(p=>p.id===h).questions,t];B(h,{questions:l})},updateQuestion:(t,s)=>{const p=o.find(f=>f.id===h).questions.map(f=>f.id===t?{...f,...s}:f);B(h,{questions:p})},removeQuestion:t=>{const l=o.find(p=>p.id===h).questions.filter(p=>p.id!==t);B(h,{questions:l})}}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(oe,{className:"mx-auto text-3xl mb-2"}),e.jsx("p",{children:"Please select a quiz from the list below to edit questions"}),e.jsx("div",{className:"mt-6 space-y-3 max-w-md mx-auto",children:o.map(t=>e.jsxs(T.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>F(t.id),className:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("h3",{className:"font-medium",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.questions?.length||0," questions â€¢ ",t.status]})]},t.id))})]})]})]})]})},H=({icon:i,title:a,value:o,loading:n})=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-full",children:i}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:a}),n?e.jsx("div",{className:"h-6 w-12 bg-gray-200 rounded mt-1 animate-pulse"}):e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:o})]})]})}),ue=({questions:i,addQuestion:a,updateQuestion:o,removeQuestion:n})=>{const[r,d]=y.useState({text:"",type:"multiple_choice",options:[{id:Date.now().toString(),text:"",correct:!1}],points:1}),u=()=>{if(!r.text.trim())return;const c={...r,id:Date.now().toString()};r.type==="true_false"?(delete c.options,c.correctAnswer=!0):r.type==="short_answer"&&delete c.options,a(c),k()},g=()=>{d({...r,options:[...r.options,{id:Date.now().toString(),text:"",correct:!1}]})},x=(c,j)=>{d({...r,options:r.options.map(N=>N.id===c?{...N,...j}:N)})},m=c=>{d({...r,options:r.options.filter(j=>j.id!==c)})},k=()=>{d({text:"",type:"multiple_choice",options:[{id:Date.now().toString(),text:"",correct:!1}],points:1})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:i.map((c,j)=>e.jsx(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-800",children:["Q",j+1,": ",c.text]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c.type==="multiple_choice"?`Multiple Choice (${c.options?.filter(N=>N.correct).length} correct)`:c.type==="true_false"?`True/False (Correct: ${c.correctAnswer?"True":"False"})`:"Short Answer"," â€¢ ",c.points," point",c.points!==1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const N={...c};c.type==="multiple_choice"&&(N.options=c.options.map(h=>({...h}))),d(N)},className:"text-blue-500 hover:text-blue-700 p-1",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>n(c.id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(te,{size:16})})]})]})},c.id))}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:"Add New Question"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Text"}),e.jsx("input",{type:"text",value:r.text,onChange:c=>d({...r,text:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your question"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Question Type"}),e.jsxs("select",{value:r.type,onChange:c=>d({...r,type:c.target.value,options:c.target.value==="multiple_choice"?[{id:Date.now().toString(),text:"",correct:!1}]:void 0,correctAnswer:c.target.value==="true_false"?!0:void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points"}),e.jsx("input",{type:"number",min:"1",value:r.points,onChange:c=>d({...r,points:parseInt(c.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),r.type==="multiple_choice"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Options"}),r.options.map((c,j)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.correct,onChange:()=>x(c.id,{correct:!c.correct}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("input",{type:"text",value:c.text,onChange:N=>x(c.id,{text:N.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:`Option ${j+1}`}),e.jsx("button",{onClick:()=>m(c.id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(_e,{size:16})})]},c.id)),e.jsxs("button",{type:"button",onClick:g,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(ee,{size:14})," Add Option"]})]}),r.type==="true_false"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correct Answer"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",checked:r.correctAnswer===!0,onChange:()=>d({...r,correctAnswer:!0}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-gray-700",children:"True"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",checked:r.correctAnswer===!1,onChange:()=>d({...r,correctAnswer:!1}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsx("span",{className:"ml-2 text-gray-700",children:"False"})]})]})]}),e.jsxs("button",{type:"button",onClick:u,disabled:!r.text.trim()||r.type==="multiple_choice"&&r.options.some(c=>!c.text.trim()),className:"flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md disabled:opacity-50",children:[e.jsx(ee,{size:16})," Add Question"]})]})]})]})};export{ht as default};
