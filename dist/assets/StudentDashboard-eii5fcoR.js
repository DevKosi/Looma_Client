import{r as a,u as ue,j as e}from"./index-DatZN8-u.js";import{a as q,d as B,b as j,g as P,q as M,h as A,w as Y,i as F,u as he,j as ge}from"./firebaseConfig-DFE2fxb7.js";import{c as pe}from"./leaderboardService-mvmICTSr.js";import{f as m,g as be,e as U,d as y,h as fe,i as je,j as ye,k as I,b as G,l as T,m as Ne,n as V,o as Z}from"./index-EHIN2_jU.js";import{A as H}from"./index-DmtjZn8v.js";import{m as w}from"./proxy-MyAIwVy1.js";function De(){const[r,X]=a.useState(null),[J,K]=a.useState([]),[x,W]=a.useState(null),[_,ee]=a.useState({user:!0,quizzes:!0}),[b,se]=a.useState(""),[v,te]=a.useState(null),[ae,z]=a.useState(!1),[k,O]=a.useState(""),[f,re]=a.useState(null),[u,S]=a.useState("quizzes"),[c,L]=a.useState("all"),[le,ie]=a.useState([]),[C,D]=a.useState(!1),[Q,h]=a.useState(null),[l,g]=a.useState(null),d=ue();a.useEffect(()=>{(async()=>{try{const t=q.currentUser;if(!t){d("/login");return}const n=B(j,"users",t.uid),i=await P(n);if(!i.exists()){d("/login");return}const o=i.data();X(o);const $=M(A(j,"quizzes"),Y("status","==","approved")),p=(await F($)).docs.map(N=>({id:N.id,...N.data()}));K(p);const xe=[...new Set(p.map(N=>N.department))];ie(xe)}catch(t){console.error("Error fetching data:",t),te({type:"error",message:"Failed to load quizzes. Please try again."})}finally{ee(t=>({...t,user:!1,quizzes:!1}))}})()},[d]);const ne=async()=>{if(r?.uid)try{const s=[],t=await F(A(j,"quizzes"));for(const i of t.docs){const o=M(A(j,"quizzes",i.id,"submissions"),Y("userId","==",r.uid));(await F(o)).docs.forEach(E=>{const p=E.data();s.push({id:E.id,quizId:i.id,quizTitle:i.data().title,quizDepartment:i.data().department,...p,submittedAt:p.submittedAt?.toDate?.()||new Date(p.submittedAt)})})}const n=pe(s);W(n)}catch(s){console.error("Error fetching user stats:",s)}};a.useEffect(()=>{r&&u==="profile"&&!x&&ne()},[r,u]);const R=J.filter(s=>{const t=s.title.toLowerCase().includes(b.toLowerCase())||s.description.toLowerCase().includes(b.toLowerCase()),n=c==="all"||s.department===c;return t&&n}),ce=s=>{re(s),O(""),h(null),g(null),z(!0)},de=()=>{d("/leaderboard")},oe=async()=>{const s=k.trim();console.log("[DEBUG] Verifying access code:",s);try{if(!f?.id)throw new Error("NO_QUIZ_SELECTED");if(!s)throw new Error("EMPTY_CODE");const t=B(j,"quizzes",f.id,"codes",s),n=await P(t);if(!n.exists())throw new Error("CODE_NOT_FOUND");const i=n.data();if(console.log("[DEBUG] Code data:",i),console.log("[DEBUG] Current user object:",r),i.used)throw new Error("CODE_ALREADY_USED");const o=q.currentUser;if(!o||!o.uid)throw new Error("USER_NOT_READY");await he(t,{used:!0,usedBy:o.uid,usedAt:ge()}),console.log("[DEBUG] Code verified and marked as used — navigating to quiz"),g("success"),h("Code verified successfully! Redirecting..."),setTimeout(()=>{d(`/quiz/${f.id}?code=${s}`)},1e3)}catch(t){console.error("[DEBUG] Verification failed:",t.message),h({NO_QUIZ_SELECTED:"No quiz selected",EMPTY_CODE:"Please enter an access code",CODE_NOT_FOUND:"Invalid access code",CODE_ALREADY_USED:"This code has already been used",USER_NOT_READY:"User not authenticated. Please reload the page.","permission-denied":"Authentication error"}[t.message]||"Failed to verify code"),g("error")}},me=async()=>{await q.signOut(),d("/login")};return _.user?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 relative",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(m,{className:"text-blue-600",size:18})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-gray-800",children:"Student Dashboard"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[r?.department," • ",r?.regNumber]})]})]}),e.jsx("div",{className:"flex items-center gap-3 sm:gap-4",children:e.jsxs("button",{onClick:me,className:"flex items-center gap-2 text-red-600 hover:text-red-700 text-sm font-medium",children:[e.jsx(be,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Out"})]})})]})})}),e.jsx("nav",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide",children:[e.jsxs("button",{onClick:()=>S("quizzes"),className:`px-3 sm:px-4 py-3 font-medium text-xs sm:text-sm flex items-center gap-2 whitespace-nowrap flex-shrink-0 ${u==="quizzes"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(m,{size:16})," Available Quizzes"]}),e.jsxs("button",{onClick:de,className:"px-3 sm:px-4 py-3 font-medium text-xs sm:text-sm flex items-center gap-2 whitespace-nowrap flex-shrink-0 text-gray-500 hover:text-gray-700",children:[e.jsx(U,{size:16})," Leaderboard"]}),e.jsxs("button",{onClick:()=>S("profile"),className:`px-3 sm:px-4 py-3 font-medium text-xs sm:text-sm flex items-center gap-2 whitespace-nowrap flex-shrink-0 ${u==="profile"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(y,{size:16})," My Profile"]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:[e.jsx(H,{children:v&&e.jsx(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`p-3 rounded-md mb-4 sm:mb-6 ${v.type==="error"?"bg-red-50 text-red-700":"bg-green-50 text-green-700"}`,children:v.message})}),u==="quizzes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 md:flex-row mb-4 sm:mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(fe,{className:"text-gray-400",size:16})}),e.jsx("input",{type:"text",placeholder:"Search quizzes...",value:b,onChange:s=>se(s.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>D(!C),className:"flex items-center justify-between gap-2 px-4 py-2 w-full md:w-56 lg:w-64 border border-gray-300 rounded-lg bg-white text-sm",children:[e.jsx("span",{className:"truncate",children:c==="all"?"All Departments":c}),e.jsx(je,{className:`transition-transform flex-shrink-0 ${C?"rotate-180":""}`,size:16})]}),C&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full md:w-56 lg:w-64 bg-white border border-gray-300 rounded-lg shadow-lg",children:[e.jsx("button",{onClick:()=>{L("all"),D(!1)},className:`block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm ${c==="all"?"bg-blue-50 text-blue-600":""}`,children:"All Departments"}),le.map(s=>e.jsx("button",{onClick:()=>{L(s),D(!1)},className:`block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm ${c===s?"bg-blue-50 text-blue-600":""}`,children:s},s))]})]})]}),_.quizzes?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[...Array(6)].map((s,t)=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6 h-40 sm:h-48 animate-pulse"},t))}):R.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 sm:p-8 text-center",children:[e.jsx(m,{className:"mx-auto text-gray-400 mb-4",size:40}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mt-4",children:b||c!=="all"?"No matching quizzes found":"No quizzes available yet"}),e.jsx("p",{className:"text-gray-500 mt-1 text-sm",children:b||c!=="all"?"Try adjusting your search or filter":"Check back later for new quizzes"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:R.map(s=>e.jsx(w.div,{whileHover:{y:-5},className:"bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200 hover:border-blue-200 transition-all",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-2",children:[e.jsxs("span",{className:"text-xs font-medium px-2 py-1 bg-green-100 text-green-800 rounded-full flex items-center gap-1 flex-shrink-0",children:[e.jsx(ye,{size:12})," Approved"]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full truncate",children:s.department}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1 flex-shrink-0",children:[e.jsx(I,{size:12})," ",s.timeLimit,"m"]})]})]}),e.jsx("h3",{className:"font-bold text-gray-800 mb-2 line-clamp-2 text-sm sm:text-base",children:s.title}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[s.questions?.length||0," questions"]}),e.jsxs("button",{onClick:()=>ce(s),className:"text-xs sm:text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(G,{size:14})," Take Quiz"]})]})]})},s.id))})]}),u==="profile"&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"px-4 sm:px-6 py-6 sm:py-8 text-white",children:e.jsxs("div",{className:"flex items-center space-x-4 sm:space-x-6",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold truncate",children:r?.fullName||"Student"}),e.jsx("p",{className:"text-blue-100 mt-1 text-sm sm:text-base",children:r?.regNumber}),e.jsxs("p",{className:"text-blue-200 text-xs sm:text-sm",children:[r?.department," Department"]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"text-blue-500"}),"Personal Information"]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Full Name"}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:r?.fullName||"Not provided"})]}),e.jsx(y,{className:"text-gray-400 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Registration Number"}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:r?.regNumber||"Not provided"})]}),e.jsx(m,{className:"text-gray-400 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Department"}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:r?.department||"Not provided"})]}),e.jsx(m,{className:"text-gray-400 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email Address"}),e.jsx("p",{className:"text-gray-900 font-semibold truncate",children:r?.email||"Not provided"})]}),e.jsx(y,{className:"text-gray-400 flex-shrink-0"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"text-green-500"}),"Academic Summary"]}),x?e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-green-600",children:"Quizzes Completed"}),e.jsx("p",{className:"text-green-900 font-bold text-xl",children:x.totalQuizzes})]}),e.jsx(m,{className:"text-green-500 w-6 h-6 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-600",children:"Average Score"}),e.jsxs("p",{className:"text-blue-900 font-bold text-xl",children:[x.averagePercentage,"%"]})]}),e.jsx(T,{className:"text-blue-500 w-6 h-6 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-yellow-600",children:"Best Performance"}),e.jsx("p",{className:"text-yellow-900 font-bold text-xl",children:x.highestScore})]}),e.jsx(U,{className:"text-yellow-500 w-6 h-6 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-purple-600",children:"Current Streak"}),e.jsx("p",{className:"text-purple-900 font-bold text-xl",children:x.recentStreak})]}),e.jsx(Ne,{className:"text-purple-500 w-6 h-6 flex-shrink-0"})]})]}):e.jsxs("div",{className:"text-center py-6 sm:py-8",children:[e.jsx(T,{className:"mx-auto text-4xl text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Take your first quiz to see your academic summary!"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"text-indigo-500"}),"Quick Actions"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("button",{onClick:()=>S("quizzes"),className:"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors text-left",children:[e.jsx(m,{className:"text-blue-500 w-6 h-6 mb-2"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:"Browse Quizzes"}),e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm",children:"Find and take available quizzes"})]}),e.jsxs("button",{onClick:()=>d("/leaderboard"),className:"p-4 border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300 transition-colors text-left",children:[e.jsx(U,{className:"text-yellow-500 w-6 h-6 mb-2"}),e.jsx("h4",{className:"font-semibold text-gray-800 text-sm sm:text-base",children:"Leaderboard"}),e.jsx("p",{className:"text-gray-500 text-xs sm:text-sm",children:"See how you rank globally"})]})]})]})]})]}),e.jsx(H,{children:ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsx(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800",children:"Enter Access Code"}),e.jsx("button",{onClick:()=>{z(!1),h(null),g(null)},className:"text-gray-500 hover:text-gray-700",disabled:l==="success",children:e.jsx(V,{size:24})})]}),Q&&e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:`mb-4 p-3 rounded-md text-sm flex items-center gap-2 ${l==="success"?"bg-green-50 text-green-600":"bg-red-50 text-red-600"}`,children:[l==="success"?e.jsx(Z,{}):e.jsx(V,{}),Q]}),e.jsxs("p",{className:"text-gray-600 mb-2 text-sm",children:["You need an access code to take ",e.jsxs("span",{className:"font-medium",children:['"',f?.title,'"']})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 mb-4",children:["Department: ",f?.department]}),e.jsx("input",{type:"text",value:k,onChange:s=>{O(s.target.value),h(null),g(null)},placeholder:"Enter your access code",className:`w-full px-4 py-2 border rounded-lg mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm ${l==="success"?"border-green-300 bg-green-50":l==="error"?"border-red-300 bg-red-50":"border-gray-300"}`,autoFocus:!0,disabled:l==="success"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3",children:[e.jsx("button",{onClick:()=>{z(!1),h(null),g(null)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 text-sm",disabled:l==="success",children:"Cancel"}),e.jsx("button",{onClick:oe,disabled:!k.trim()||l==="success",className:`px-4 py-2 rounded-lg text-white flex items-center justify-center gap-1 text-sm ${l==="success"?"bg-green-500":l==="error"?"bg-red-500":"bg-blue-600 hover:bg-blue-700"} disabled:opacity-50`,children:l==="success"?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"animate-pulse"})," Verified"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{})," Verify Code"]})})]})]})})})})]})}export{De as default};
